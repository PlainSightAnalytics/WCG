
CREATE PROCEDURE [itis].[prcExtractevent]

--------------------------------------------------------------------------------------------------------------------------------------
-- Author				:	Generated from Model
-- Date Created			:	13-09-2019 11:51:40
-- Reason				:	Reads JSON file and inserts data into Stage table (event)
--------------------------------------------------------------------------------------------------------------------------------------
-- Inputs				:	@FileName, @DeltaLogKey, @AuditKey
-- Ouputs				:	@RowCountStage
-- Test					:	exec itis.prcExtractevent 'D:\PSA\WCG\utilities\sample\event.json'
--------------------------------------------------------------------------------------------------------------------------------------
-- Modified By	:
-- Modified On	:
-- Reason				:
--------------------------------------------------------------------------------------------------------------------------------------

@FileName NVARCHAR(MAX),
@DeltaLogKey INT = -1,
@AuditKey INT = -1,
@TruncateFlag INT = 1

AS

IF @TruncateFlag = 1 TRUNCATE TABLE [itis].[event]

DECLARE @sql AS NVARCHAR(MAX)

SET @sql = 'DECLARE @json NVARCHAR(MAX) ' + CHAR(13)
SET @sql = @sql + 'SELECT @json = BulkColumn FROM OPENROWSET (BULK ''' + @FileName + ''', SINGLE_CLOB) as j' + CHAR(13)
SET @sql = @sql + 'INSERT INTO [itis].[event] (' + CHAR(13)
SET @sql = @sql + '[id], ' + CHAR(13)
SET @sql = @sql + '[type], ' + CHAR(13)
SET @sql = @sql + '[updated_at], ' + CHAR(13)
SET @sql = @sql + '[display], ' + CHAR(13)
--Insert Begin
SET @sql = @sql + '[control_room_user_id], ' + CHAR(13)
SET @sql = @sql + '[departure_point_id], ' + CHAR(13)
SET @sql = @sql + '[device_id], ' + CHAR(13)
SET @sql = @sql + '[ems_user_id], ' + CHAR(13)
SET @sql = @sql + '[first_break_location_id], ' + CHAR(13)
SET @sql = @sql + '[fme_destination_id], ' + CHAR(13)
SET @sql = @sql + '[land_transport_survey_user_id], ' + CHAR(13)
SET @sql = @sql + '[magistrates_court_id], ' + CHAR(13)
SET @sql = @sql + '[primary_driver_id], ' + CHAR(13)
SET @sql = @sql + '[primary_vehicle_id], ' + CHAR(13)
SET @sql = @sql + '[road_safety_user_id], ' + CHAR(13)
SET @sql = @sql + '[second_break_location_id], ' + CHAR(13)
SET @sql = @sql + '[shift_statistic_id], ' + CHAR(13)
SET @sql = @sql + '[site_id], ' + CHAR(13)
SET @sql = @sql + '[third_break_location_id], ' + CHAR(13)
SET @sql = @sql + '[traffic_centre_id], ' + CHAR(13)
SET @sql = @sql + '[user_id], ' + CHAR(13)
SET @sql = @sql + '[action_taken_key], ' + CHAR(13)
SET @sql = @sql + '[action_taken_display], ' + CHAR(13)
SET @sql = @sql + '[alcohol_and_drugs_key], ' + CHAR(13)
SET @sql = @sql + '[alcohol_and_drugs_display], ' + CHAR(13)
SET @sql = @sql + '[alcohol_level], ' + CHAR(13)
SET @sql = @sql + '[alcohol_screening_key], ' + CHAR(13)
SET @sql = @sql + '[alcohol_screening_display], ' + CHAR(13)
SET @sql = @sql + '[alcohol_visual_screening_comment], ' + CHAR(13)
SET @sql = @sql + '[amount_of_breaks_key], ' + CHAR(13)
SET @sql = @sql + '[amount_of_breaks_display], ' + CHAR(13)
SET @sql = @sql + '[arrival_time], ' + CHAR(13)
SET @sql = @sql + '[blood_glucose_level], ' + CHAR(13)
SET @sql = @sql + '[blood_pressure_diastolic], ' + CHAR(13)
SET @sql = @sql + '[blood_pressure_systolic], ' + CHAR(13)
SET @sql = @sql + '[break_taken_key], ' + CHAR(13)
SET @sql = @sql + '[break_taken_display], ' + CHAR(13)
SET @sql = @sql + '[business_address_city], ' + CHAR(13)
SET @sql = @sql + '[business_address_code], ' + CHAR(13)
SET @sql = @sql + '[business_address_line1], ' + CHAR(13)
SET @sql = @sql + '[business_address_line2], ' + CHAR(13)
SET @sql = @sql + '[business_address_province_key], ' + CHAR(13)
SET @sql = @sql + '[business_address_province_display], ' + CHAR(13)
SET @sql = @sql + '[business_telephone_number], ' + CHAR(13)
SET @sql = @sql + '[checked_brakes_steering_key], ' + CHAR(13)
SET @sql = @sql + '[checked_brakes_steering_display], ' + CHAR(13)
SET @sql = @sql + '[checked_doors_windows_mirrors_key], ' + CHAR(13)
SET @sql = @sql + '[checked_doors_windows_mirrors_display], ' + CHAR(13)
SET @sql = @sql + '[checked_fuel_system_key], ' + CHAR(13)
SET @sql = @sql + '[checked_fuel_system_display], ' + CHAR(13)
SET @sql = @sql + '[checked_lights_key], ' + CHAR(13)
SET @sql = @sql + '[checked_lights_display], ' + CHAR(13)
SET @sql = @sql + '[checked_markings_signs_key], ' + CHAR(13)
SET @sql = @sql + '[checked_markings_signs_display], ' + CHAR(13)
SET @sql = @sql + '[checked_numberplate_key], ' + CHAR(13)
SET @sql = @sql + '[checked_numberplate_display], ' + CHAR(13)
SET @sql = @sql + '[checked_passengers_key], ' + CHAR(13)
SET @sql = @sql + '[checked_passengers_display], ' + CHAR(13)
SET @sql = @sql + '[checked_seatbelts_key], ' + CHAR(13)
SET @sql = @sql + '[checked_seatbelts_display], ' + CHAR(13)
SET @sql = @sql + '[checked_tyres_key], ' + CHAR(13)
SET @sql = @sql + '[checked_tyres_display], ' + CHAR(13)
SET @sql = @sql + '[checked_windscreen_key], ' + CHAR(13)
SET @sql = @sql + '[checked_windscreen_display], ' + CHAR(13)
SET @sql = @sql + '[comments], ' + CHAR(13)
SET @sql = @sql + '[completed_at], ' + CHAR(13)
SET @sql = @sql + '[court_code], ' + CHAR(13)
SET @sql = @sql + '[court_date], ' + CHAR(13)
SET @sql = @sql + '[court_name], ' + CHAR(13)
SET @sql = @sql + '[court_no], ' + CHAR(13)
SET @sql = @sql + '[current_statutory_duties_sub_category_key], ' + CHAR(13)
SET @sql = @sql + '[current_statutory_duties_sub_category_display], ' + CHAR(13)
SET @sql = @sql + '[custom_email_address], ' + CHAR(13)
SET @sql = @sql + '[date], ' + CHAR(13)
SET @sql = @sql + '[datetime_impound_offence], ' + CHAR(13)
SET @sql = @sql + '[departure_time], ' + CHAR(13)
SET @sql = @sql + '[direction_key], ' + CHAR(13)
SET @sql = @sql + '[direction_display], ' + CHAR(13)
SET @sql = @sql + '[disregard_instructions_key], ' + CHAR(13)
SET @sql = @sql + '[disregard_instructions_display], ' + CHAR(13)
SET @sql = @sql + '[driver_identification_done_key], ' + CHAR(13)
SET @sql = @sql + '[driver_identification_done_display], ' + CHAR(13)
SET @sql = @sql + '[driver_signature], ' + CHAR(13)
SET @sql = @sql + '[driver_signature_for_survey], ' + CHAR(13)
SET @sql = @sql + '[driving_violations_key], ' + CHAR(13)
SET @sql = @sql + '[driving_violations_display], ' + CHAR(13)
SET @sql = @sql + '[elapsed_time_in_minutes], ' + CHAR(13)
SET @sql = @sql + '[ems_result_comments], ' + CHAR(13)
SET @sql = @sql + '[ems_testing_key], ' + CHAR(13)
SET @sql = @sql + '[ems_testing_display], ' + CHAR(13)
SET @sql = @sql + '[event_details_done_key], ' + CHAR(13)
SET @sql = @sql + '[event_details_done_display], ' + CHAR(13)
SET @sql = @sql + '[event_source_key], ' + CHAR(13)
SET @sql = @sql + '[event_source_display], ' + CHAR(13)
SET @sql = @sql + '[event_type_key], ' + CHAR(13)
SET @sql = @sql + '[event_type_display], ' + CHAR(13)
SET @sql = @sql + '[force_closed_type_key], ' + CHAR(13)
SET @sql = @sql + '[force_closed_type_display], ' + CHAR(13)
SET @sql = @sql + '[force_close_reason], ' + CHAR(13)
SET @sql = @sql + '[google_expected_duration_minutes], ' + CHAR(13)
SET @sql = @sql + '[gps_location_latitude], ' + CHAR(13)
SET @sql = @sql + '[gps_location_longitude], ' + CHAR(13)
SET @sql = @sql + '[gps_location_altitude], ' + CHAR(13)
SET @sql = @sql + '[gps_location_horizontal_accuracy], ' + CHAR(13)
SET @sql = @sql + '[gps_location_vertical_accuracy], ' + CHAR(13)
SET @sql = @sql + '[gps_location_timestamp], ' + CHAR(13)
SET @sql = @sql + '[has_impound_violations_key], ' + CHAR(13)
SET @sql = @sql + '[has_impound_violations_display], ' + CHAR(13)
SET @sql = @sql + '[has_moving_violation_key], ' + CHAR(13)
SET @sql = @sql + '[has_moving_violation_display], ' + CHAR(13)
SET @sql = @sql + '[has_no_ag_violations_key], ' + CHAR(13)
SET @sql = @sql + '[has_no_ag_violations_display], ' + CHAR(13)
SET @sql = @sql + '[has_violation_key], ' + CHAR(13)
SET @sql = @sql + '[has_violation_display], ' + CHAR(13)
SET @sql = @sql + '[heart_rate], ' + CHAR(13)
SET @sql = @sql + '[is_archived_key], ' + CHAR(13)
SET @sql = @sql + '[is_archived_display], ' + CHAR(13)
SET @sql = @sql + '[is_draft_key], ' + CHAR(13)
SET @sql = @sql + '[is_draft_display], ' + CHAR(13)
SET @sql = @sql + '[kilometer_distance], ' + CHAR(13)
SET @sql = @sql + '[location_description], ' + CHAR(13)
SET @sql = @sql + '[location_name], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_2], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_3], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_4], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_5], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_6], ' + CHAR(13)
SET @sql = @sql + '[number_of_passengers], ' + CHAR(13)
SET @sql = @sql + '[number_of_people_wearing_seat_belts], ' + CHAR(13)
SET @sql = @sql + '[officer_signature], ' + CHAR(13)
SET @sql = @sql + '[opened_at], ' + CHAR(13)
SET @sql = @sql + '[operating_license_number], ' + CHAR(13)
SET @sql = @sql + '[operating_license_photo], ' + CHAR(13)
SET @sql = @sql + '[payment_date], ' + CHAR(13)
SET @sql = @sql + '[place_brake_taken], ' + CHAR(13)
SET @sql = @sql + '[police_station], ' + CHAR(13)
SET @sql = @sql + '[public_transport_survey_completed_key], ' + CHAR(13)
SET @sql = @sql + '[public_transport_survey_completed_display], ' + CHAR(13)
SET @sql = @sql + '[regulatory_signs_key], ' + CHAR(13)
SET @sql = @sql + '[regulatory_signs_display], ' + CHAR(13)
SET @sql = @sql + '[residential_address_city], ' + CHAR(13)
SET @sql = @sql + '[residential_address_code], ' + CHAR(13)
SET @sql = @sql + '[residential_address_line1], ' + CHAR(13)
SET @sql = @sql + '[residential_address_line2], ' + CHAR(13)
SET @sql = @sql + '[residential_address_province_key], ' + CHAR(13)
SET @sql = @sql + '[residential_address_province_display], ' + CHAR(13)
SET @sql = @sql + '[residential_telephone_number], ' + CHAR(13)
SET @sql = @sql + '[reviewed_enatis_feedback_key], ' + CHAR(13)
SET @sql = @sql + '[reviewed_enatis_feedback_display], ' + CHAR(13)
SET @sql = @sql + '[road_markings_key], ' + CHAR(13)
SET @sql = @sql + '[road_markings_display], ' + CHAR(13)
SET @sql = @sql + '[road_number], ' + CHAR(13)
SET @sql = @sql + '[road_safety_comments], ' + CHAR(13)
SET @sql = @sql + '[road_safety_completed], ' + CHAR(13)
SET @sql = @sql + '[road_safety_topics_discussed_with], ' + CHAR(13)
SET @sql = @sql + '[road_section], ' + CHAR(13)
SET @sql = @sql + '[sect_56_at_near_by], ' + CHAR(13)
SET @sql = @sql + '[signed_at], ' + CHAR(13)
SET @sql = @sql + '[speed_violations_key], ' + CHAR(13)
SET @sql = @sql + '[speed_violations_display], ' + CHAR(13)
SET @sql = @sql + '[status_key], ' + CHAR(13)
SET @sql = @sql + '[status_display], ' + CHAR(13)
SET @sql = @sql + '[time_taken], ' + CHAR(13)
SET @sql = @sql + '[total], ' + CHAR(13)
SET @sql = @sql + '[transport_key], ' + CHAR(13)
SET @sql = @sql + '[transport_display], ' + CHAR(13)
SET @sql = @sql + '[trip_type_key], ' + CHAR(13)
SET @sql = @sql + '[trip_type_display], ' + CHAR(13)
SET @sql = @sql + '[vehicle_group_photo], ' + CHAR(13)
SET @sql = @sql + '[vehicle_identification_done_key], ' + CHAR(13)
SET @sql = @sql + '[vehicle_identification_done_display], ' + CHAR(13)
SET @sql = @sql + '[deltalogkey],' + CHAR(13)
SET @sql = @sql + '[auditkey]' + CHAR(13)
--Insert End
SET @sql = @sql + ')' + CHAR(13)
SET @sql = @sql + 'SELECT ' 
--Select Begin
SET @sql = @sql + '[id], ' + CHAR(13)
SET @sql = @sql + '[type], ' + CHAR(13)
SET @sql = @sql + '[updated_at], ' + CHAR(13)
SET @sql = @sql + '[display], ' + CHAR(13)
SET @sql = @sql + '[control_room_user_id], ' + CHAR(13)
SET @sql = @sql + '[departure_point_id], ' + CHAR(13)
SET @sql = @sql + '[device_id], ' + CHAR(13)
SET @sql = @sql + '[ems_user_id], ' + CHAR(13)
SET @sql = @sql + '[first_break_location_id], ' + CHAR(13)
SET @sql = @sql + '[fme_destination_id], ' + CHAR(13)
SET @sql = @sql + '[land_transport_survey_user_id], ' + CHAR(13)
SET @sql = @sql + '[magistrates_court_id], ' + CHAR(13)
SET @sql = @sql + '[primary_driver_id], ' + CHAR(13)
SET @sql = @sql + '[primary_vehicle_id], ' + CHAR(13)
SET @sql = @sql + '[road_safety_user_id], ' + CHAR(13)
SET @sql = @sql + '[second_break_location_id], ' + CHAR(13)
SET @sql = @sql + '[shift_statistic_id], ' + CHAR(13)
SET @sql = @sql + '[site_id], ' + CHAR(13)
SET @sql = @sql + '[third_break_location_id], ' + CHAR(13)
SET @sql = @sql + '[traffic_centre_id], ' + CHAR(13)
SET @sql = @sql + '[user_id], ' + CHAR(13)
SET @sql = @sql + '[action_taken_key], ' + CHAR(13)
SET @sql = @sql + '[action_taken_display], ' + CHAR(13)
SET @sql = @sql + '[alcohol_and_drugs_key], ' + CHAR(13)
SET @sql = @sql + '[alcohol_and_drugs_display], ' + CHAR(13)
SET @sql = @sql + '[alcohol_level], ' + CHAR(13)
SET @sql = @sql + '[alcohol_screening_key], ' + CHAR(13)
SET @sql = @sql + '[alcohol_screening_display], ' + CHAR(13)
SET @sql = @sql + '[alcohol_visual_screening_comment], ' + CHAR(13)
SET @sql = @sql + '[amount_of_breaks_key], ' + CHAR(13)
SET @sql = @sql + '[amount_of_breaks_display], ' + CHAR(13)
SET @sql = @sql + '[arrival_time], ' + CHAR(13)
SET @sql = @sql + '[blood_glucose_level], ' + CHAR(13)
SET @sql = @sql + '[blood_pressure_diastolic], ' + CHAR(13)
SET @sql = @sql + '[blood_pressure_systolic], ' + CHAR(13)
SET @sql = @sql + '[break_taken_key], ' + CHAR(13)
SET @sql = @sql + '[break_taken_display], ' + CHAR(13)
SET @sql = @sql + '[business_address_city], ' + CHAR(13)
SET @sql = @sql + '[business_address_code], ' + CHAR(13)
SET @sql = @sql + '[business_address_line1], ' + CHAR(13)
SET @sql = @sql + '[business_address_line2], ' + CHAR(13)
SET @sql = @sql + '[business_address_province_key], ' + CHAR(13)
SET @sql = @sql + '[business_address_province_display], ' + CHAR(13)
SET @sql = @sql + '[business_telephone_number], ' + CHAR(13)
SET @sql = @sql + '[checked_brakes_steering_key], ' + CHAR(13)
SET @sql = @sql + '[checked_brakes_steering_display], ' + CHAR(13)
SET @sql = @sql + '[checked_doors_windows_mirrors_key], ' + CHAR(13)
SET @sql = @sql + '[checked_doors_windows_mirrors_display], ' + CHAR(13)
SET @sql = @sql + '[checked_fuel_system_key], ' + CHAR(13)
SET @sql = @sql + '[checked_fuel_system_display], ' + CHAR(13)
SET @sql = @sql + '[checked_lights_key], ' + CHAR(13)
SET @sql = @sql + '[checked_lights_display], ' + CHAR(13)
SET @sql = @sql + '[checked_markings_signs_key], ' + CHAR(13)
SET @sql = @sql + '[checked_markings_signs_display], ' + CHAR(13)
SET @sql = @sql + '[checked_numberplate_key], ' + CHAR(13)
SET @sql = @sql + '[checked_numberplate_display], ' + CHAR(13)
SET @sql = @sql + '[checked_passengers_key], ' + CHAR(13)
SET @sql = @sql + '[checked_passengers_display], ' + CHAR(13)
SET @sql = @sql + '[checked_seatbelts_key], ' + CHAR(13)
SET @sql = @sql + '[checked_seatbelts_display], ' + CHAR(13)
SET @sql = @sql + '[checked_tyres_key], ' + CHAR(13)
SET @sql = @sql + '[checked_tyres_display], ' + CHAR(13)
SET @sql = @sql + '[checked_windscreen_key], ' + CHAR(13)
SET @sql = @sql + '[checked_windscreen_display], ' + CHAR(13)
SET @sql = @sql + '[comments], ' + CHAR(13)
SET @sql = @sql + '[completed_at], ' + CHAR(13)
SET @sql = @sql + '[court_code], ' + CHAR(13)
SET @sql = @sql + '[court_date], ' + CHAR(13)
SET @sql = @sql + '[court_name], ' + CHAR(13)
SET @sql = @sql + '[court_no], ' + CHAR(13)
SET @sql = @sql + '[current_statutory_duties_sub_category_key], ' + CHAR(13)
SET @sql = @sql + '[current_statutory_duties_sub_category_display], ' + CHAR(13)
SET @sql = @sql + '[custom_email_address], ' + CHAR(13)
SET @sql = @sql + '[date], ' + CHAR(13)
SET @sql = @sql + '[datetime_impound_offence], ' + CHAR(13)
SET @sql = @sql + '[departure_time], ' + CHAR(13)
SET @sql = @sql + '[direction_key], ' + CHAR(13)
SET @sql = @sql + '[direction_display], ' + CHAR(13)
SET @sql = @sql + '[disregard_instructions_key], ' + CHAR(13)
SET @sql = @sql + '[disregard_instructions_display], ' + CHAR(13)
SET @sql = @sql + '[driver_identification_done_key], ' + CHAR(13)
SET @sql = @sql + '[driver_identification_done_display], ' + CHAR(13)
SET @sql = @sql + '[driver_signature], ' + CHAR(13)
SET @sql = @sql + '[driver_signature_for_survey], ' + CHAR(13)
SET @sql = @sql + '[driving_violations_key], ' + CHAR(13)
SET @sql = @sql + '[driving_violations_display], ' + CHAR(13)
SET @sql = @sql + '[elapsed_time_in_minutes], ' + CHAR(13)
SET @sql = @sql + '[ems_result_comments], ' + CHAR(13)
SET @sql = @sql + '[ems_testing_key], ' + CHAR(13)
SET @sql = @sql + '[ems_testing_display], ' + CHAR(13)
SET @sql = @sql + '[event_details_done_key], ' + CHAR(13)
SET @sql = @sql + '[event_details_done_display], ' + CHAR(13)
SET @sql = @sql + '[event_source_key], ' + CHAR(13)
SET @sql = @sql + '[event_source_display], ' + CHAR(13)
SET @sql = @sql + '[event_type_key], ' + CHAR(13)
SET @sql = @sql + '[event_type_display], ' + CHAR(13)
SET @sql = @sql + '[force_closed_type_key], ' + CHAR(13)
SET @sql = @sql + '[force_closed_type_display], ' + CHAR(13)
SET @sql = @sql + '[force_close_reason], ' + CHAR(13)
SET @sql = @sql + '[google_expected_duration_minutes], ' + CHAR(13)
SET @sql = @sql + '[gps_location_latitude], ' + CHAR(13)
SET @sql = @sql + '[gps_location_longitude], ' + CHAR(13)
SET @sql = @sql + '[gps_location_altitude], ' + CHAR(13)
SET @sql = @sql + '[gps_location_horizontal_accuracy], ' + CHAR(13)
SET @sql = @sql + '[gps_location_vertical_accuracy], ' + CHAR(13)
SET @sql = @sql + '[gps_location_timestamp], ' + CHAR(13)
SET @sql = @sql + '[has_impound_violations_key], ' + CHAR(13)
SET @sql = @sql + '[has_impound_violations_display], ' + CHAR(13)
SET @sql = @sql + '[has_moving_violation_key], ' + CHAR(13)
SET @sql = @sql + '[has_moving_violation_display], ' + CHAR(13)
SET @sql = @sql + '[has_no_ag_violations_key], ' + CHAR(13)
SET @sql = @sql + '[has_no_ag_violations_display], ' + CHAR(13)
SET @sql = @sql + '[has_violation_key], ' + CHAR(13)
SET @sql = @sql + '[has_violation_display], ' + CHAR(13)
SET @sql = @sql + '[heart_rate], ' + CHAR(13)
SET @sql = @sql + '[is_archived_key], ' + CHAR(13)
SET @sql = @sql + '[is_archived_display], ' + CHAR(13)
SET @sql = @sql + '[is_draft_key], ' + CHAR(13)
SET @sql = @sql + '[is_draft_display], ' + CHAR(13)
SET @sql = @sql + '[kilometer_distance], ' + CHAR(13)
SET @sql = @sql + '[location_description], ' + CHAR(13)
SET @sql = @sql + '[location_name], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_2], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_3], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_4], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_5], ' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_6], ' + CHAR(13)
SET @sql = @sql + '[number_of_passengers], ' + CHAR(13)
SET @sql = @sql + '[number_of_people_wearing_seat_belts], ' + CHAR(13)
SET @sql = @sql + '[officer_signature], ' + CHAR(13)
SET @sql = @sql + '[opened_at], ' + CHAR(13)
SET @sql = @sql + '[operating_license_number], ' + CHAR(13)
SET @sql = @sql + '[operating_license_photo], ' + CHAR(13)
SET @sql = @sql + '[payment_date], ' + CHAR(13)
SET @sql = @sql + '[place_brake_taken], ' + CHAR(13)
SET @sql = @sql + '[police_station], ' + CHAR(13)
SET @sql = @sql + '[public_transport_survey_completed_key], ' + CHAR(13)
SET @sql = @sql + '[public_transport_survey_completed_display], ' + CHAR(13)
SET @sql = @sql + '[regulatory_signs_key], ' + CHAR(13)
SET @sql = @sql + '[regulatory_signs_display], ' + CHAR(13)
SET @sql = @sql + '[residential_address_city], ' + CHAR(13)
SET @sql = @sql + '[residential_address_code], ' + CHAR(13)
SET @sql = @sql + '[residential_address_line1], ' + CHAR(13)
SET @sql = @sql + '[residential_address_line2], ' + CHAR(13)
SET @sql = @sql + '[residential_address_province_key], ' + CHAR(13)
SET @sql = @sql + '[residential_address_province_display], ' + CHAR(13)
SET @sql = @sql + '[residential_telephone_number], ' + CHAR(13)
SET @sql = @sql + '[reviewed_enatis_feedback_key], ' + CHAR(13)
SET @sql = @sql + '[reviewed_enatis_feedback_display], ' + CHAR(13)
SET @sql = @sql + '[road_markings_key], ' + CHAR(13)
SET @sql = @sql + '[road_markings_display], ' + CHAR(13)
SET @sql = @sql + '[road_number], ' + CHAR(13)
SET @sql = @sql + '[road_safety_comments], ' + CHAR(13)
SET @sql = @sql + '[road_safety_completed], ' + CHAR(13)
SET @sql = @sql + '[road_safety_topics_discussed_with], ' + CHAR(13)
SET @sql = @sql + '[road_section], ' + CHAR(13)
SET @sql = @sql + '[sect_56_at_near_by], ' + CHAR(13)
SET @sql = @sql + '[signed_at], ' + CHAR(13)
SET @sql = @sql + '[speed_violations_key], ' + CHAR(13)
SET @sql = @sql + '[speed_violations_display], ' + CHAR(13)
SET @sql = @sql + '[status_key], ' + CHAR(13)
SET @sql = @sql + '[status_display], ' + CHAR(13)
SET @sql = @sql + '[time_taken], ' + CHAR(13)
SET @sql = @sql + '[total], ' + CHAR(13)
SET @sql = @sql + '[transport_key], ' + CHAR(13)
SET @sql = @sql + '[transport_display], ' + CHAR(13)
SET @sql = @sql + '[trip_type_key], ' + CHAR(13)
SET @sql = @sql + '[trip_type_display], ' + CHAR(13)
SET @sql = @sql + '[vehicle_group_photo], ' + CHAR(13)
SET @sql = @sql + '[vehicle_identification_done_key], ' + CHAR(13)
SET @sql = @sql + '[vehicle_identification_done_display], ' + CHAR(13)
--Select End
SET @sql = @sql + CAST(@DeltaLogKey AS VARCHAR(10)) + ',' + CAST(@AuditKey AS VARCHAR(10)) +  CHAR(13)
SET @sql = @sql + 'FROM OPENJSON(@json, ''$.objects'') '   + CHAR(13)
SET @sql = @sql + 'WITH ( ' + CHAR(13)
--WITH Begin
SET @sql = @sql + '[id] [uniqueidentifier] ''$.id'',' + CHAR(13)
SET @sql = @sql + '[type] [nvarchar](max) ''$.type'',' + CHAR(13)
SET @sql = @sql + '[updated_at] [nvarchar](max) ''$.updated_at'',' + CHAR(13)
SET @sql = @sql + '[display] [nvarchar](max) ''$.display'',' + CHAR(13)
SET @sql = @sql + '[control_room_user_id] [varchar](max) ''$.control_room_user_id'',' + CHAR(13)
SET @sql = @sql + '[departure_point_id] [varchar](max) ''$.departure_point_id'',' + CHAR(13)
SET @sql = @sql + '[device_id] [varchar](max) ''$.device_id'',' + CHAR(13)
SET @sql = @sql + '[ems_user_id] [varchar](max) ''$.ems_user_id'',' + CHAR(13)
SET @sql = @sql + '[first_break_location_id] [varchar](max) ''$.first_break_location_id'',' + CHAR(13)
SET @sql = @sql + '[fme_destination_id] [varchar](max) ''$.fme_destination_id'',' + CHAR(13)
SET @sql = @sql + '[land_transport_survey_user_id] [varchar](max) ''$.land_transport_survey_user_id'',' + CHAR(13)
SET @sql = @sql + '[magistrates_court_id] [varchar](max) ''$.magistrates_court_id'',' + CHAR(13)
SET @sql = @sql + '[primary_driver_id] [varchar](max) ''$.primary_driver_id'',' + CHAR(13)
SET @sql = @sql + '[primary_vehicle_id] [varchar](max) ''$.primary_vehicle_id'',' + CHAR(13)
SET @sql = @sql + '[road_safety_user_id] [varchar](max) ''$.road_safety_user_id'',' + CHAR(13)
SET @sql = @sql + '[second_break_location_id] [varchar](max) ''$.second_break_location_id'',' + CHAR(13)
SET @sql = @sql + '[shift_statistic_id] [varchar](max) ''$.shift_statistic_id'',' + CHAR(13)
SET @sql = @sql + '[site_id] [varchar](max) ''$.site_id'',' + CHAR(13)
SET @sql = @sql + '[third_break_location_id] [varchar](max) ''$.third_break_location_id'',' + CHAR(13)
SET @sql = @sql + '[traffic_centre_id] [varchar](max) ''$.traffic_centre_id'',' + CHAR(13)
SET @sql = @sql + '[user_id] [varchar](max) ''$.user_id'',' + CHAR(13)
SET @sql = @sql + '[action_taken_key] [varchar](max) ''$.action_taken.key'',' + CHAR(13)
SET @sql = @sql + '[action_taken_display] [varchar](max) ''$.action_taken.display'',' + CHAR(13)
SET @sql = @sql + '[alcohol_and_drugs_key] [varchar](max) ''$.alcohol_and_drugs.key'',' + CHAR(13)
SET @sql = @sql + '[alcohol_and_drugs_display] [varchar](max) ''$.alcohol_and_drugs.display'',' + CHAR(13)
SET @sql = @sql + '[alcohol_level] [varchar](max) ''$.alcohol_level'',' + CHAR(13)
SET @sql = @sql + '[alcohol_screening_key] [varchar](max) ''$.alcohol_screening.key'',' + CHAR(13)
SET @sql = @sql + '[alcohol_screening_display] [varchar](max) ''$.alcohol_screening.display'',' + CHAR(13)
SET @sql = @sql + '[alcohol_visual_screening_comment] [varchar](max) ''$.alcohol_visual_screening_comment'',' + CHAR(13)
SET @sql = @sql + '[amount_of_breaks_key] [varchar](max) ''$.amount_of_breaks.key'',' + CHAR(13)
SET @sql = @sql + '[amount_of_breaks_display] [varchar](max) ''$.amount_of_breaks.display'',' + CHAR(13)
SET @sql = @sql + '[arrival_time] [varchar](max) ''$.arrival_time'',' + CHAR(13)
SET @sql = @sql + '[blood_glucose_level] [varchar](max) ''$.blood_glucose_level'',' + CHAR(13)
SET @sql = @sql + '[blood_pressure_diastolic] [varchar](max) ''$.blood_pressure_diastolic'',' + CHAR(13)
SET @sql = @sql + '[blood_pressure_systolic] [varchar](max) ''$.blood_pressure_systolic'',' + CHAR(13)
SET @sql = @sql + '[break_taken_key] [varchar](max) ''$.break_taken.key'',' + CHAR(13)
SET @sql = @sql + '[break_taken_display] [varchar](max) ''$.break_taken.display'',' + CHAR(13)
SET @sql = @sql + '[business_address_city] [varchar](max) ''$.business_address_city'',' + CHAR(13)
SET @sql = @sql + '[business_address_code] [varchar](max) ''$.business_address_code'',' + CHAR(13)
SET @sql = @sql + '[business_address_line1] [varchar](max) ''$.business_address_line1'',' + CHAR(13)
SET @sql = @sql + '[business_address_line2] [varchar](max) ''$.business_address_line2'',' + CHAR(13)
SET @sql = @sql + '[business_address_province_key] [varchar](max) ''$.business_address_province.key'',' + CHAR(13)
SET @sql = @sql + '[business_address_province_display] [varchar](max) ''$.business_address_province.display'',' + CHAR(13)
SET @sql = @sql + '[business_telephone_number] [varchar](max) ''$.business_telephone_number'',' + CHAR(13)
SET @sql = @sql + '[checked_brakes_steering_key] [varchar](max) ''$.checked_brakes_steering.key'',' + CHAR(13)
SET @sql = @sql + '[checked_brakes_steering_display] [varchar](max) ''$.checked_brakes_steering.display'',' + CHAR(13)
SET @sql = @sql + '[checked_doors_windows_mirrors_key] [varchar](max) ''$.checked_doors_windows_mirrors.key'',' + CHAR(13)
SET @sql = @sql + '[checked_doors_windows_mirrors_display] [varchar](max) ''$.checked_doors_windows_mirrors.display'',' + CHAR(13)
SET @sql = @sql + '[checked_fuel_system_key] [varchar](max) ''$.checked_fuel_system.key'',' + CHAR(13)
SET @sql = @sql + '[checked_fuel_system_display] [varchar](max) ''$.checked_fuel_system.display'',' + CHAR(13)
SET @sql = @sql + '[checked_lights_key] [varchar](max) ''$.checked_lights.key'',' + CHAR(13)
SET @sql = @sql + '[checked_lights_display] [varchar](max) ''$.checked_lights.display'',' + CHAR(13)
SET @sql = @sql + '[checked_markings_signs_key] [varchar](max) ''$.checked_markings_signs.key'',' + CHAR(13)
SET @sql = @sql + '[checked_markings_signs_display] [varchar](max) ''$.checked_markings_signs.display'',' + CHAR(13)
SET @sql = @sql + '[checked_numberplate_key] [varchar](max) ''$.checked_numberplate.key'',' + CHAR(13)
SET @sql = @sql + '[checked_numberplate_display] [varchar](max) ''$.checked_numberplate.display'',' + CHAR(13)
SET @sql = @sql + '[checked_passengers_key] [varchar](max) ''$.checked_passengers.key'',' + CHAR(13)
SET @sql = @sql + '[checked_passengers_display] [varchar](max) ''$.checked_passengers.display'',' + CHAR(13)
SET @sql = @sql + '[checked_seatbelts_key] [varchar](max) ''$.checked_seatbelts.key'',' + CHAR(13)
SET @sql = @sql + '[checked_seatbelts_display] [varchar](max) ''$.checked_seatbelts.display'',' + CHAR(13)
SET @sql = @sql + '[checked_tyres_key] [varchar](max) ''$.checked_tyres.key'',' + CHAR(13)
SET @sql = @sql + '[checked_tyres_display] [varchar](max) ''$.checked_tyres.display'',' + CHAR(13)
SET @sql = @sql + '[checked_windscreen_key] [varchar](max) ''$.checked_windscreen.key'',' + CHAR(13)
SET @sql = @sql + '[checked_windscreen_display] [varchar](max) ''$.checked_windscreen.display'',' + CHAR(13)
SET @sql = @sql + '[comments] [varchar](max) ''$.comments'',' + CHAR(13)
SET @sql = @sql + '[completed_at] [varchar](max) ''$.completed_at'',' + CHAR(13)
SET @sql = @sql + '[court_code] [varchar](max) ''$.court_code'',' + CHAR(13)
SET @sql = @sql + '[court_date] [varchar](max) ''$.court_date'',' + CHAR(13)
SET @sql = @sql + '[court_name] [varchar](max) ''$.court_name'',' + CHAR(13)
SET @sql = @sql + '[court_no] [varchar](max) ''$.court_no'',' + CHAR(13)
SET @sql = @sql + '[current_statutory_duties_sub_category_key] [varchar](max) ''$.current_statutory_duties_sub_category.key'',' + CHAR(13)
SET @sql = @sql + '[current_statutory_duties_sub_category_display] [varchar](max) ''$.current_statutory_duties_sub_category.display'',' + CHAR(13)
SET @sql = @sql + '[custom_email_address] [varchar](max) ''$.custom_email_address'',' + CHAR(13)
SET @sql = @sql + '[date] [varchar](max) ''$.date'',' + CHAR(13)
SET @sql = @sql + '[datetime_impound_offence] [varchar](max) ''$.datetime_impound_offence'',' + CHAR(13)
SET @sql = @sql + '[departure_time] [varchar](max) ''$.departure_time'',' + CHAR(13)
SET @sql = @sql + '[direction_key] [varchar](max) ''$.direction.key'',' + CHAR(13)
SET @sql = @sql + '[direction_display] [varchar](max) ''$.direction.display'',' + CHAR(13)
SET @sql = @sql + '[disregard_instructions_key] [varchar](max) ''$.disregard_instructions.key'',' + CHAR(13)
SET @sql = @sql + '[disregard_instructions_display] [varchar](max) ''$.disregard_instructions.display'',' + CHAR(13)
SET @sql = @sql + '[driver_identification_done_key] [varchar](max) ''$.driver_identification_done.key'',' + CHAR(13)
SET @sql = @sql + '[driver_identification_done_display] [varchar](max) ''$.driver_identification_done.display'',' + CHAR(13)
SET @sql = @sql + '[driver_signature] [varchar](max) ''$.driver_signature'',' + CHAR(13)
SET @sql = @sql + '[driver_signature_for_survey] [varchar](max) ''$.driver_signature_for_survey'',' + CHAR(13)
SET @sql = @sql + '[driving_violations_key] [varchar](max) ''$.driving_violations.key'',' + CHAR(13)
SET @sql = @sql + '[driving_violations_display] [varchar](max) ''$.driving_violations.display'',' + CHAR(13)
SET @sql = @sql + '[elapsed_time_in_minutes] [varchar](max) ''$.elapsed_time_in_minutes'',' + CHAR(13)
SET @sql = @sql + '[ems_result_comments] [varchar](max) ''$.ems_result_comments'',' + CHAR(13)
SET @sql = @sql + '[ems_testing_key] [varchar](max) ''$.ems_testing.key'',' + CHAR(13)
SET @sql = @sql + '[ems_testing_display] [varchar](max) ''$.ems_testing.display'',' + CHAR(13)
SET @sql = @sql + '[event_details_done_key] [varchar](max) ''$.event_details_done.key'',' + CHAR(13)
SET @sql = @sql + '[event_details_done_display] [varchar](max) ''$.event_details_done.display'',' + CHAR(13)
SET @sql = @sql + '[event_source_key] [varchar](max) ''$.event_source.key'',' + CHAR(13)
SET @sql = @sql + '[event_source_display] [varchar](max) ''$.event_source.display'',' + CHAR(13)
SET @sql = @sql + '[event_type_key] [varchar](max) ''$.event_type.key'',' + CHAR(13)
SET @sql = @sql + '[event_type_display] [varchar](max) ''$.event_type.display'',' + CHAR(13)
SET @sql = @sql + '[force_closed_type_key] [varchar](max) ''$.force_closed_type.key'',' + CHAR(13)
SET @sql = @sql + '[force_closed_type_display] [varchar](max) ''$.force_closed_type.display'',' + CHAR(13)
SET @sql = @sql + '[force_close_reason] [varchar](max) ''$.force_close_reason'',' + CHAR(13)
SET @sql = @sql + '[google_expected_duration_minutes] [varchar](max) ''$.google_expected_duration_minutes'',' + CHAR(13)
SET @sql = @sql + '[gps_location_latitude] [varchar](max) ''$.gps_location.latitude'',' + CHAR(13)
SET @sql = @sql + '[gps_location_longitude] [varchar](max) ''$.gps_location.longitude'',' + CHAR(13)
SET @sql = @sql + '[gps_location_altitude] [varchar](max) ''$.gps_location.altitude'',' + CHAR(13)
SET @sql = @sql + '[gps_location_horizontal_accuracy] [varchar](max) ''$.gps_location.horizontal_accuracy'',' + CHAR(13)
SET @sql = @sql + '[gps_location_vertical_accuracy] [varchar](max) ''$.gps_location.vertical_accuracy'',' + CHAR(13)
SET @sql = @sql + '[gps_location_timestamp] [varchar](max) ''$.gps_location.timestamp'',' + CHAR(13)
SET @sql = @sql + '[has_impound_violations_key] [varchar](max) ''$.has_impound_violations.key'',' + CHAR(13)
SET @sql = @sql + '[has_impound_violations_display] [varchar](max) ''$.has_impound_violations.display'',' + CHAR(13)
SET @sql = @sql + '[has_moving_violation_key] [varchar](max) ''$.has_moving_violation.key'',' + CHAR(13)
SET @sql = @sql + '[has_moving_violation_display] [varchar](max) ''$.has_moving_violation.display'',' + CHAR(13)
SET @sql = @sql + '[has_no_ag_violations_key] [varchar](max) ''$.has_no_ag_violations.key'',' + CHAR(13)
SET @sql = @sql + '[has_no_ag_violations_display] [varchar](max) ''$.has_no_ag_violations.display'',' + CHAR(13)
SET @sql = @sql + '[has_violation_key] [varchar](max) ''$.has_violation.key'',' + CHAR(13)
SET @sql = @sql + '[has_violation_display] [varchar](max) ''$.has_violation.display'',' + CHAR(13)
SET @sql = @sql + '[heart_rate] [varchar](max) ''$.heart_rate'',' + CHAR(13)
SET @sql = @sql + '[is_archived_key] [varchar](max) ''$.is_archived.key'',' + CHAR(13)
SET @sql = @sql + '[is_archived_display] [varchar](max) ''$.is_archived.display'',' + CHAR(13)
SET @sql = @sql + '[is_draft_key] [varchar](max) ''$.is_draft.key'',' + CHAR(13)
SET @sql = @sql + '[is_draft_display] [varchar](max) ''$.is_draft.display'',' + CHAR(13)
SET @sql = @sql + '[kilometer_distance] [varchar](max) ''$.kilometer_distance'',' + CHAR(13)
SET @sql = @sql + '[location_description] [varchar](max) ''$.location_description'',' + CHAR(13)
SET @sql = @sql + '[location_name] [varchar](max) ''$.location_name'',' + CHAR(13)
SET @sql = @sql + '[manual_sect_56] [varchar](max) ''$.manual_sect_56'',' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_2] [varchar](max) ''$.manual_sect_56_2'',' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_3] [varchar](max) ''$.manual_sect_56_3'',' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_4] [varchar](max) ''$.manual_sect_56_4'',' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_5] [varchar](max) ''$.manual_sect_56_5'',' + CHAR(13)
SET @sql = @sql + '[manual_sect_56_6] [varchar](max) ''$.manual_sect_56_6'',' + CHAR(13)
SET @sql = @sql + '[number_of_passengers] [varchar](max) ''$.number_of_passengers'',' + CHAR(13)
SET @sql = @sql + '[number_of_people_wearing_seat_belts] [varchar](max) ''$.number_of_people_wearing_seat_belts'',' + CHAR(13)
SET @sql = @sql + '[officer_signature] [varchar](max) ''$.officer_signature'',' + CHAR(13)
SET @sql = @sql + '[opened_at] [varchar](max) ''$.opened_at'',' + CHAR(13)
SET @sql = @sql + '[operating_license_number] [varchar](max) ''$.operating_license_number'',' + CHAR(13)
SET @sql = @sql + '[operating_license_photo] [varchar](max) ''$.operating_license_photo'',' + CHAR(13)
SET @sql = @sql + '[payment_date] [varchar](max) ''$.payment_date'',' + CHAR(13)
SET @sql = @sql + '[place_brake_taken] [varchar](max) ''$.place_brake_taken'',' + CHAR(13)
SET @sql = @sql + '[police_station] [varchar](max) ''$.police_station'',' + CHAR(13)
SET @sql = @sql + '[public_transport_survey_completed_key] [varchar](max) ''$.public_transport_survey_completed.key'',' + CHAR(13)
SET @sql = @sql + '[public_transport_survey_completed_display] [varchar](max) ''$.public_transport_survey_completed.display'',' + CHAR(13)
SET @sql = @sql + '[regulatory_signs_key] [varchar](max) ''$.regulatory_signs.key'',' + CHAR(13)
SET @sql = @sql + '[regulatory_signs_display] [varchar](max) ''$.regulatory_signs.display'',' + CHAR(13)
SET @sql = @sql + '[residential_address_city] [varchar](max) ''$.residential_address_city'',' + CHAR(13)
SET @sql = @sql + '[residential_address_code] [varchar](max) ''$.residential_address_code'',' + CHAR(13)
SET @sql = @sql + '[residential_address_line1] [varchar](max) ''$.residential_address_line1'',' + CHAR(13)
SET @sql = @sql + '[residential_address_line2] [varchar](max) ''$.residential_address_line2'',' + CHAR(13)
SET @sql = @sql + '[residential_address_province_key] [varchar](max) ''$.residential_address_province.key'',' + CHAR(13)
SET @sql = @sql + '[residential_address_province_display] [varchar](max) ''$.residential_address_province.display'',' + CHAR(13)
SET @sql = @sql + '[residential_telephone_number] [varchar](max) ''$.residential_telephone_number'',' + CHAR(13)
SET @sql = @sql + '[reviewed_enatis_feedback_key] [varchar](max) ''$.reviewed_enatis_feedback.key'',' + CHAR(13)
SET @sql = @sql + '[reviewed_enatis_feedback_display] [varchar](max) ''$.reviewed_enatis_feedback.display'',' + CHAR(13)
SET @sql = @sql + '[road_markings_key] [varchar](max) ''$.road_markings.key'',' + CHAR(13)
SET @sql = @sql + '[road_markings_display] [varchar](max) ''$.road_markings.display'',' + CHAR(13)
SET @sql = @sql + '[road_number] [varchar](max) ''$.road_number'',' + CHAR(13)
SET @sql = @sql + '[road_safety_comments] [varchar](max) ''$.road_safety_comments'',' + CHAR(13)
SET @sql = @sql + '[road_safety_completed] [varchar](max) ''$.road_safety_completed'',' + CHAR(13)
SET @sql = @sql + '[road_safety_topics_discussed_with] [varchar](max) ''$.road_safety_topics_discussed_with'',' + CHAR(13)
SET @sql = @sql + '[road_section] [varchar](max) ''$.road_section'',' + CHAR(13)
SET @sql = @sql + '[sect_56_at_near_by] [varchar](max) ''$.sect_56_at_near_by'',' + CHAR(13)
SET @sql = @sql + '[signed_at] [varchar](max) ''$.signed_at'',' + CHAR(13)
SET @sql = @sql + '[speed_violations_key] [varchar](max) ''$.speed_violations.key'',' + CHAR(13)
SET @sql = @sql + '[speed_violations_display] [varchar](max) ''$.speed_violations.display'',' + CHAR(13)
SET @sql = @sql + '[status_key] [varchar](max) ''$.status.key'',' + CHAR(13)
SET @sql = @sql + '[status_display] [varchar](max) ''$.status.display'',' + CHAR(13)
SET @sql = @sql + '[time_taken] [varchar](max) ''$.time_taken'',' + CHAR(13)
SET @sql = @sql + '[total] [varchar](max) ''$.total'',' + CHAR(13)
SET @sql = @sql + '[transport_key] [varchar](max) ''$.transport.key'',' + CHAR(13)
SET @sql = @sql + '[transport_display] [varchar](max) ''$.transport.display'',' + CHAR(13)
SET @sql = @sql + '[trip_type_key] [varchar](max) ''$.trip_type.key'',' + CHAR(13)
SET @sql = @sql + '[trip_type_display] [varchar](max) ''$.trip_type.display'',' + CHAR(13)
SET @sql = @sql + '[vehicle_group_photo] [varchar](max) ''$.vehicle_group_photo'',' + CHAR(13)
SET @sql = @sql + '[vehicle_identification_done_key] [varchar](max) ''$.vehicle_identification_done.key'',' + CHAR(13)
SET @sql = @sql + '[vehicle_identification_done_display] [varchar](max) ''$.vehicle_identification_done.display''' + CHAR(13)
--WITH End
SET @sql = @sql + ')' + CHAR(13)

EXEC(@SQL)

